<!DOCTYPE html>
<html class="no-js" lang="">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>cart</title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link rel="manifest" href="site.html" />
    <link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico" />

    <!-- CSS here -->
    <link rel="stylesheet" href="/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/css/owl.carousel.min.css" />
    <link rel="stylesheet" href="/css/fontawesome.min.css" />
    <link rel="stylesheet" href="/css/jquery-ui.css" />
    <link rel="stylesheet" href="/css/animate.min.css" />
    <link rel="stylesheet" href="/css/magnific-popup.css" />
    <link rel="stylesheet" href="/css/fontawesome-all.min.css" />
    <link rel="stylesheet" href="/css/meanmenu.css" />
    <link rel="stylesheet" href="/css/slick.css" />
    <link rel="stylesheet" href="/css/default.css" />
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/responsive.css" />

    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css"
    />
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/toastify-js"
    ></script>

    <style>
      .incrementButton {
        border: 0.5px solid rgb(162, 162, 162);
        margin-top: 0.4rem;
      }
      .decrementButton {
        border: 0.5px solid rgb(162, 162, 162);
        margin-top: 0.4rem;
      }

      .empty-cart {
        text-align: center;
        height: 12.33rem;
        padding: 20px;
        background-color: #f5f5f5;
        border: 1px solid #ddd;
        border-radius: 5px;
        margin-top: 20px;
      }
    </style>
  </head>

  <body>
    <!-- preloader -->
    <!-- <div id="loader-wrapper">
      <div id="loader"></div>
    </div> -->

    <!-- header -->
    <%- include('../partials/header') %>

    <!-- shop body section start -->
    <main class="container-lg mx-5">
      <section class="cart-area pt-50 pb-50">
        <div class="container d-flex flex-column flex-md-row">
          <div class="d-flex w-100">
            <image
              src="<%= service.images[0] %>"
              alt=""
              width="200"
              height="200"
            />

            <div class="ml-4">
              <h3><%= service.title %></h3>
              <p><%= service.description %></p>
              <p>Price: â‚¹<%= service.sellingPrice %></p>
            </div>
          </div>

          <div class="d-flex flex-column w-100">
            <div class="form-group">
              <label for="date">Choose date</label>
              <input
                id="date"
                name="date"
                type="date"
                class="form-control"
                value="<%= date %>"
                min="<%= new Date().toISOString().split('T')[0] %>"
              />
            </div>

            <div id="slotsContainer" class="mt-3">
              <p>Select date to load slots</p>
            </div>

            <form
              id="proceedForm"
              method="POST"
              action="/book/checkout"
              class="mt-3"
            >
              <input
                type="hidden"
                name="serviceId"
                value="<%= service._id %>"
              />
              <input type="hidden" name="date" id="selectedDate" value="" />
              <input type="hidden" name="slot" id="selectedSlot" value="" />
              <button
                id="proceedBtn"
                type="submit"
                class="btn btn-primary border"
                disabled
              >
                Proceed
              </button>
            </form>
          </div>
        </div>
      </section>
    </main>


    <!--- LINKED AXIOS -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      const serviceId = "<%= service._id %>";
      function loadSlots(date) {
        $("#slotsContainer").html("<p>Loading slots...</p>");
        $.getJSON(`/service/${serviceId}/slots?date=${date}`)
          .done((res) => {
            if (!res.slots || res.slots.length === 0) {
              $("#slotsContainer").html(
                '<div class="alert alert-warning">No slots available</div>',
              );
              $("#proceedBtn").prop("disabled", true);
              return;
            }
            let html = '<div class="list-group">';
            res.slots.forEach((s) => {
              html += `<div class="list-group-item d-flex justify-content-between align-items-center">
            <div>${s.slot}</div>
            <div><button class="btn btn-sm btn-outline-success select-slot border" data-slot="${s.slot}">Select</button></div>
          </div>`;
            });
            html += "</div>";
            $("#slotsContainer").html(html);
            $("#proceedBtn").prop("disabled", true);
          })
          .fail(() => {
            $("#slotsContainer").html(
              '<div class="alert alert-danger">Error loading slots</div>',
            );
          });
      }

      $(function () {
        const $date = $("#date");
        loadSlots($date.val());

        $date.on("change", function () {
          loadSlots(this.value);
          $("#selectedSlot").val("");
          $("#selectedDate").val("");
          $("#proceedBtn").prop("disabled", true);
        });

        $(document).on("click", ".select-slot", function (e) {
          e.preventDefault();
          $(".select-slot")
            .removeClass("btn-success")
            .addClass("btn-outline-success")
            .text("Select");
          $(this)
            .removeClass("btn-outline-success")
            .addClass("btn-success")
            .text("Selected");
          const slot = $(this).data("slot");
          $("#selectedSlot").val(slot);
          $("#selectedDate").val($("#date").val());
          $("#proceedBtn").prop("disabled", false);
        });
      });
    </script>

    <!-- footer -->
    <%- include('../partials/footer') %>

    <!-- JS here -->
    <script src="/js/vendor/jquery-1.12.4.min.js"></script>
    <script src="/js/popper.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/owl.carousel.min.js"></script>
    <script src="/js/isotope.pkgd.min.js"></script>
    <script src="/js/one-page-nav-min.js"></script>
    <script src="/js/slick.min.js"></script>
    <script src="/js/jquery.meanmenu.min.js"></script>
    <script src="/js/ajax-form.js"></script>
    <script src="/js/fontawesome.min.js"></script>
    <script src="/js/wow.min.js"></script>
    <script src="/js/jquery-ui.js"></script>
    <script src="/js/jquery.scrollUp.min.js"></script>
    <script src="/js/imagesloaded.pkgd.min.js"></script>
    <script src="/js/jquery.magnific-popup.min.js"></script>
    <script src="/js/plugins.js"></script>
    <script src="/js/main.js"></script>
  </body>

</html>
