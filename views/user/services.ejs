<!DOCTYPE html>
<html class="no-js" lang="">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>Services</title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link rel="manifest" href="site.html" />
    <link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico" />

    <!-- CSS here -->
    <link rel="stylesheet" href="/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/css/owl.carousel.min.css" />
    <link rel="stylesheet" href="/css/fontawesome.min.css" />
    <link rel="stylesheet" href="/css/jquery-ui.css" />
    <link rel="stylesheet" href="/css/animate.min.css" />
    <link rel="stylesheet" href="/css/magnific-popup.css" />
    <link rel="stylesheet" href="/css/fontawesome-all.min.css" />
    <link rel="stylesheet" href="/css/meanmenu.css" />
    <link rel="stylesheet" href="/css/slick.css" />
    <link rel="stylesheet" href="/css/default.css" />
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/responsive.css" />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css"
    />

    <!-- toastify -->
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css"
    />
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/toastify-js"
    ></script>

    <!-- axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  </head>
  <style>
    .product-img {
      position: relative;
      overflow: hidden;
    }

    .product-img img {
      transition: transform 0.5s ease;
    }

    .product-img:hover img {
      animation: zoom-in 5s infinite;
    }

    @keyframes zoom-in {
      0% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.1);
      }
      100% {
        transform: scale(1);
      }
    }

    /* filter styles */
    .filter-popup {
      position: absolute;
      top: calc(100% + 10px);
      right: 0;
      background: #393939;
      padding: 20px;
      z-index: 999;
      border-radius: 4px;
      display: none;
      max-width: 250px;
      width: 100%;
    }

    .filter-popup.active {
      display: block;
    }

    @media (min-width: 768px) {
      .filter-popup {
        max-width: 250px;
        right: 0;
        left: auto;
      }
    }

    @media (max-width: 767px) {
      .hide-on-small {
        display: none;
      }
    }
  </style>
  <body>
    <!-- preloader -->
    <div id="loader-wrapper">
      <div id="loader"></div>
    </div>

    <!-- header  -->
  <%- include('../partials/header') %>

    <div class="col-12">
      <div id="searchSmallScreen" class="d-flex d-sm-none">
        <input
          type="text"
          class="col-11"
          name="search"
          id="searchInput1"
          placeholder="Search..."
          style="
            padding: 5px;
            border-radius: 2px;
            border: 1px solid #ccc;
            margin-right: 1px;
            width: -webkit-fill-available;
          "
        />
        <button
          id="searchButtonSmall"
          class="col-1"
          style="
            padding: 5px 6px 5px 3px;
            border: none;
            border-radius: 2px;
            background-color: #3e3f3f;
            color: #fff;
            cursor: pointer;
          "
        >
          <i class="fal fa-search"></i>
        </button>
      </div>
    </div>

      <div class="container-fluid">
        <nav aria-label="breadcrumb" class="mb-40">
          <ol class="breadcrumb p-0 m-0"></ol>
        </nav>
        <div class="shop-wrapper">
          <div class="row">
            <div class="col-12">
              <div class="filter-heading">
                <div class="row justify-content-end px-4">
                  <div class="sorting d-inline-block">
                    <select name="sort" id="shop-sort" class="">
                      <option value="Default">Default sorting</option>
                      <option value="latest">Sort by latest</option>
                      <option value="low_to_high">
                        Sort by price: low to high
                      </option>
                      <option value="high_to_low">
                        Sort by price: high to low
                      </option>
                    </select>
                  </div>

                  <div class="filter">
                    <h6 class="d-inline-block filter-widget-toggle">Filter</h6>
                    <div class="filter-popup" style="display: none">
                      <div class="row justify-content-center">
                        <div class="">
                          <div class="widget">
                            <h4 class="mb-30 text-light">Category</h4>
                            <div class="category-list">
                              <% allCategories.forEach(category => { %>
                              <ul>
                                <li>
                                  <a
                                    href="#"
                                    class="<%= currentCategory === category ? ' bg-primary text-light' : '' %>"
                                    onclick="getProductsByCategory('<%= category %>',event)"
                                    ><%= category %></a
                                  >
                                </li>
                              </ul>
                              <% }) %>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="filter-content">
                <div class="tab-content">
                  <div
                    id="productList"
                    data-products="<%- JSON.stringify(services) %>"
                  >
                    <div class="tab-pane fade show active" id="shop-tab-3">
                      <div class="product-wrapper mt-55">
                        <div class="row" id="productDisplay">
                        <% if (services.length === 0) { %>
                          <div class="col-12 text-center py-5">
                            <h4>No services found</h4>
                          </div>
                        <% } else { %>
                          <% services.forEach(service => { %>
                            <div class="col-xl-3 col-lg-3 col-md-4 col-sm-6 col-12">
                              <div class="product-box mb-40">
                                <div class="product-box-wrapper">
                                  <div class="product-img">
                                    <a href="/service/<%= service._id %>" class="product-category">
                                      <img src="<%= service.images[0] %>" class="w-100" alt="<%= service.title %>" />
                                    </a>
                                  </div>

                                  <div class="product-desc pb-20">
                                    <a href="/service/<%= service._id %>" class="product-title">
                                      <%= service.title %>
                                    </a>
                                    <span>â‚¹ <%= service.sellingPrice %></span>
                                  </div>
                                </div>
                                <a href="/service/<%= service._id %>/book" class="bg-primary px-4 py-2 rounded d-flex justify-content-center align-items-center text-white">
                                  Book Now
                                </a>
                              </div>
                            </div>
                          <% }); %>
                        <% } %>

                        </div>

                        <div class="d-flex justify-content-center mt-20 mb-20">
                          <nav aria-label="Page navigation example">
                            <% 
                              const queryParams = new URLSearchParams(request.query);
                              queryParams.delete('page');
                              const baseQuery = queryParams.toString() ? `&${queryParams.toString()}` : '';
                            %>

                            <ul class="pagination justify-content-end">

                              <% if (hasPrevPage) { %>
                              <li class="page-item">
                                <a class="page-link bg-dark text-white" 
                                  href="/services?page=<%= prevPage %><%= baseQuery %>" 
                                  aria-label="Previous">
                                  <span aria-hidden="true">&laquo;</span>
                                </a>
                              </li>

                              <% } else { %>
                              <li class="page-item disabled">
                                <a class="page-link bg-light text-dark" href="#" tabindex="-1" aria-label="Previous">
                                  <span aria-hidden="true">&laquo;</span>
                                </a>
                              </li>
                              <% } %>

                              <% for (let i = 1; i <= lastPage; i++) { %>
                              <li class="page-item <%= i === currentPage ? 'active' : '' %>">
                                <a class="page-link <%= i === currentPage ? 'bg-dark text-white' : 'bg-light text-dark' %>" 
                                  href="/services?page=<%= i %><%= baseQuery %>">
                                  <%= i %>
                                </a>
                              </li>
                              <% } %>

                              <% if (hasNextPage) { %>
                              <li class="page-item">
                                <a class="page-link bg-dark text-white" 
                                  href="/services?page=<%= nextPage %><%= baseQuery %>" 
                                  aria-label="Next">
                                  <span aria-hidden="true">&raquo;</span>
                                </a>
                              </li>

                              <% } else { %>
                              <li class="page-item disabled">
                                <a class="page-link bg-light text-dark" href="#" tabindex="-1" aria-label="Next">
                                  <span aria-hidden="true">&raquo;</span>
                                </a>
                              </li>
                              <% } %>

                            </ul>
                          </nav>
                        </div>


                        
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- footer  -->
      <%- include('../partials/footer') %>
      <script>
        // Toggle visibility of search input and button for larger screens
        const searchContainer = document.getElementById("searchContainer");
        const searchLargeScreen = document.getElementById("searchLargeScreen");
        const searchIconSmallScreen = document.getElementById(
          "searchIconSmallScreen"
        );

        function toggleSearchInput() {
          if (window.innerWidth >= 700) {
            searchLargeScreen.style.display = "flex";
            searchIconSmallScreen.style.display = "none";
          } else {
            searchIconSmallScreen.style.display = "flex";
          }
        }

        window.onload = toggleSearchInput;
        window.onresize = toggleSearchInput;
      </script>

      <script>
        //  category
        function getProductsByCategory(category, event) {
          event.preventDefault(); 

          const urlParams = new URLSearchParams(window.location.search);
          const existingCategory = urlParams.get('category');

          if (
            existingCategory &&
            existingCategory.trim().toLowerCase() === category.trim().toLowerCase()
          ) {
            urlParams.delete('category');
          } else {
            urlParams.set('category', category);
          }

          urlParams.delete('page');

          const newUrl = `/services?${urlParams.toString()}`;
          window.location.href = newUrl;
        }


        // sort
        document.addEventListener("DOMContentLoaded", () => {
          const sortSelect = document.getElementById("shop-sort");

          const urlParams = new URLSearchParams(window.location.search);
          const currentSort = urlParams.get("sort") || "Default";

          sortSelect.value = currentSort;

          sortSelect.addEventListener("change", (e) => {
            const newSort = e.target.value;

            const params = new URLSearchParams(window.location.search);
            params.set("sort", newSort);
            params.delete("page"); 

            window.location.href = `/services?${params.toString()}`;
          });
        });

       
      </script>

      <script>
        $(document).ready(function () {
          $(".filter-widget-toggle").click(function () {
            $(".filter-popup").toggleClass("active");
          });

          // Clicking outside the filter popup closes it
          $(document).click(function (event) {
            if (!$(event.target).closest(".filter").length) {
              $(".filter-popup").removeClass("active");
            }
          });
        });

        $(document).ready(function () {
          $("#searchIcon").click(function () {
            $("#smallSearchPopup").toggle();
          });
        });
      </script>

      <!-- JS here -->
      <script src="/js/vendor/jquery-1.12.4.min.js"></script>
      <script src="/js/popper.min.js"></script>
      <script src="/js/bootstrap.min.js"></script>
      <script src="/js/owl.carousel.min.js"></script>
      <script src="/js/isotope.pkgd.min.js"></script>
      <script src="/js/one-page-nav-min.js"></script>
      <script src="/js/slick.min.js"></script>
      <script src="/js/jquery.meanmenu.min.js"></script>
      <script src="/js/ajax-form.js"></script>
      <script src="/js/fontawesome.min.js"></script>
      <script src="/js/wow.min.js"></script>
      <script src="/js/jquery-ui.js"></script>
      <script src="/js/jquery.scrollUp.min.js"></script>
      <script src="/js/imagesloaded.pkgd.min.js"></script>
      <script src="/js/jquery.magnific-popup.min.js"></script>
      <script src="/js/plugins.js"></script>
      <script src="/js/main.js"></script>
    </div>
  </body>
</html>
